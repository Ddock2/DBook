drop table db_user CASCADE CONSTRAINTS;
drop table book CASCADE CONSTRAINTS;
drop table best_seller CASCADE CONSTRAINTS;
drop table interest CASCADE CONSTRAINTS;
drop table recent_view CASCADE CONSTRAINTS;
drop table review CASCADE CONSTRAINTS;
drop table review_reaction CASCADE CONSTRAINTS;
drop table db_category CASCADE CONSTRAINTS;
drop table db_category_management CASCADE CONSTRAINTS;

drop sequence seq_db_user_no;
drop sequence review_no;

create sequence seq_db_user_no;
create table db_user (
        no              number(10)        not null 
    ,   id              varchar2(30)      primary key
    ,   password        varchar2(30)
    ,   profile_image   varchar2(120)
    ,   thumbnail_image varchar2(120)
    ,   nickname        varchar2(30)
    ,   age_range       varchar2(8)
    ,   gender          varchar2(12)
    ,   reg_date        date            default sysdate
);

CREATE TABLE book ( 
        book_id                VARCHAR2(10)     primary key
    ,   book_name              VARCHAR2(128)
    ,   category_no            VARCHAR2(9)
    ,   author                 VARCHAR2(26)
    ,   translator             VARCHAR2(26)
    ,   publisher              VARCHAR2(26)
    ,   published_date         VARCHAR2(10)
    ,   is_ebook               VARCHAR2(7)
    ,   form_detail            VARCHAR2(7)
    ,   isbn                   VARCHAR2(13)
    ,   view_cnt               NUMBER(8)        default 0
    ,   book_introduction      VARCHAR2(4000)
    ,   author_introduction    VARCHAR2(4000)
    ,   contents               VARCHAR2(4000)
    ,   cover                  VARCHAR2(150)
                    );

create table best_seller (
        sell_period         date
    ,   book_id             varchar2(20)
    ,   constraint best_seller_no_fk foreign key(book_id)
        references book(book_id) on delete cascade
);

create table interest (
        id              varchar2(30)
    ,   book_id         varchar2(20)
    ,   constraint interest_id_fk foreign key(id)
        references db_user(id) on delete cascade
    ,   constraint interest_book_id_fk foreign key(book_id)
        references book(book_id) on delete cascade
);

create table recent_view (
        id              varchar2(30)
    ,   book_id         varchar2(20)
    ,   constraint recent_view_id_fk foreign key(id)
        references db_user(id) on delete cascade
    ,   constraint recent_view_book_id_fk foreign key(book_id)
        references book(book_id) on delete cascade
);

create sequence review_no;
create table review (
        review_no       number(10)     primary key
    ,   id              varchar2(30)
    ,   book_id         varchar2(20)
    ,   rating          number(2)
    ,   content         varchar2(4000)
    ,   good            number(10)     default 0
    ,   bad             number(10)     default 0
    ,   review_reg_date date              default sysdate
    ,   constraint review_id_fk foreign key(id)
        references db_user(id) on delete cascade
    ,   constraint review_book_id_fk foreign key(book_id)
        references book(book_id) on delete cascade
);

create table review_reaction (
        review_no       number(10)    
    ,   id              varchar2(30)
    ,   good_or_bad     number(1)
    ,   constraint review_reaction_no_fk foreign key(review_no)
        references review(review_no) on delete cascade
    ,   constraint review_reaction_id_fk foreign key(id)
        references db_user(id) on delete cascade
);

create table db_category_management (
        category_no     varchar(9)      primary key
    ,   category        varchar(20)     not null
    ,   parent_no       number(10)
);

create table db_category (
        book_id         varchar2(20)
    ,   category_no     varchar(9)
    ,   constraint db_category_book_id_fk foreign key(book_id)
        references book(book_id) on delete cascade
    ,   constraint db_category_category_no_fk foreign key(category_no)
        references db_category_management(category_no)
);

Insert into HR.DB_USER (NO,ID,PASSWORD,PROFILE_IMAGE,THUMBNAIL_IMAGE,NICKNAME,AGE_RANGE,GENDER) values (seq_db_user_no.nextval,'q','q',null,null,'q','20~29','male');

commit;