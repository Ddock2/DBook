<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.project.review.dao.ReviewDAO">
	
	<!-- 리뷰 등록 -->	
	<insert id="writeReview" parameterType="reviewVO">
		insert into review(review_no, id, book_id, rating, content, good, bad)
			   values(review_no.nextval, #{id}, #{book_id}, #{rating}, #{content}, #{good}, #{bad})
	</insert>
	
	<!-- 회원가입 리뷰 등록 -->	
	<insert id="addUserRating" parameterType="reviewVO">
		insert into review(review_no, id, book_id, rating)
			   values(review_no.nextval, #{id}, #{book_id}, #{rating})
	</insert>
	
	<!-- 리뷰 book_id로 불러오기 -->	
	<select id="reviewListByBook_id" resultType="reviewVO" parameterType="string">
		select review_no, r.id, book_id, rating, content, good, bad, to_char(review_reg_date, 'yyyy-mm-dd') as review_reg_date, nickname
		  from review r inner join db_user u
		    on r.id = u.id
		  where book_id = #{book_id}
		  order by review_no desc
	</select>
	
	<!-- 책 평점 불러오기 -->	
	<select id="book_avg_rating" resultType="Integer" parameterType="string">
		select rating
		  from review
		  where book_id = #{book_id}
	</select>
	
	
</mapper>