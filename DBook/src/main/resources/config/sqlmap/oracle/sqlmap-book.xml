<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.project.book.dao.BookDAO">
	
	<!-- book_id로 책 정보 조회 -->	
	<select id="bookDetail" resultType="bookVO" parameterType="bookVO">
		select book_id, book_name, cover, author, translator, publisher, to_char(published_date, 'yyyy-mm-dd') as published_date,
			   is_ebook, form_detail, isbn, book_introduction, author_introduction, contents, view_cnt 
		  from book
		  where book_id = #{book_id}
	</select>
	
	<!-- 책 조회수 올리기 -->
	<update id="upView_cnt" parameterType="String">
		update book 
			set		view_cnt = view_cnt + 1
			where 	book_id = #{book_id}
	</update>
	
	<!-- 카테고리 별로 책 n권씩 가져오기  -->
	<select id="booklistByCategory" resultType="bookVO" parameterType="categoryVO">
		select br.book_id , br.book_name , br.category_no , br.publisher , br.published_date , br.cover
		from ( 
		    select rownum as rnum, b.book_id , b.book_name , b.category_no , b.publisher , b.published_date , b.cover
		    from (
			        select book_id, book_name, category_no, publisher , published_date , cover
			        from book
			        where category_no like #{categoryNumber} || '%'
			        order by published_date desc ) b
		    where #{end} >= rownum ) br
		where br.rnum >= #{start}
	</select>
	
	<!-- 책 검색 결과로 책 n권씩 가져오기 -->
	<select id="booklistByKeyword" resultType="bookVO" parameterType="searchVO">
		select br.book_id , br.book_name , br.author, br.category_no , br.publisher , br.published_date , br.cover
		from ( 
		    select rownum as rnum, b.book_id , b.author, b.book_name , b.category_no , b.publisher , b.published_date , b.cover
		    from (
			        select book_id, book_name, author, category_no, publisher , published_date , cover
			        from book
			        where book_name like '%'||#{keyword}||'%' or author like '%'||#{keyword}||'%'
			        order by published_date desc ) b
		    where #{end} >= rownum ) br
		where br.rnum >= #{start} 
	</select>
</mapper>